require 'coffee-script/register'
fs = require 'fs'
stream = require 'stream'
Speaker = require 'speaker'
VoiceText = require '../src/lib/voicetext'

voice = new VoiceText('simmp87vt1urexli')
#voice = new VoiceText('<your api key>')

text = process.argv[2] or 'きょうも いちにち がんばるぞい'

voice
.speaker(voice.SPEAKER.SHOW)
.emotion(voice.EMOTION.HAPPINESS)
.emotion_level(voice.EMOTION_LEVEL.HIGH)
.pitch(100)
.speed(100)
.volume(200)
.speak text, (e, buf)->
  return console.error e if e

  speaker = new Speaker
    channels: 1
    bitDepth: 16
    sampleRate: 16000

  bufferStream = new stream.Transform
  bufferStream.pipe speaker
  bufferStream.push buf
  do bufferStream.end

